(function(k){console.log(k);let e=k.blockEditor;let t=k.element;let l=k.blocks;let o=e.RichText;let w=k.components.Placeholder;let A=k.components.ToolbarButton;let T=k.components.ToolbarGroup;let B=e.BlockControls;let L=k.components.ToggleControl;let P=k.components.ColorPicker;let O=k.components.Modal;let x=k.components.SelectControl;let R=k.components.SandBox;let n=k.components.FlexBlock;const a=k.element.createElement("svg",{viewBox:"0 0 38 38",foreground:"#ff0000"},k.element.createElement("path",{d:"M32.82,10.32H44.9a.2.2,0,0,1,.18.29L39.82,22.53a.51.51,0,0,1-.47.31H23.46a.52.52,0,0,1-.5-.38L17,1.08A1.49,1.49,0,0,0,15.53,0H11.6A1.56,1.56,0,0,0,10,1.48c-.05,2,2.79,1.35,4,1.46a.52.52,0,0,1,.49.38l6,21.39A1.48,1.48,0,0,0,22,25.79H40.69a1.49,1.49,0,0,0,1.37-.88L48.88,9.43a1.48,1.48,0,0,0-1.37-2.06H32.86a5.2,5.2,0,0,1,0,3Z",transform:"translate(-9.99)",fill:"#09bbd8"}),k.element.createElement("path",{d:"M27.75,5.1a3.63,3.63,0,1,1-3.63,3.63A3.64,3.64,0,0,1,27.75,5.1Z",transform:"translate(-9.99)",fill:"#ef4658"}));console.log(k.components.Icon);const U=k.element.createElement("svg",{viewBox:"0 0 24 24",foreground:"#ff0000"},k.element.createElement("path",{d:"M20.1 5.1L16.9 2 6.2 12.7l-1.3 4.4 4.5-1.3L20.1 5.1zM4 20.8h8v-1.5H4v1.5z"}));let I=t.createElement;l.registerBlockType("talkshoplive/player",{title:"TalkShopLive Player",icon:a,category:"talkshoplive",supports:{align:true},attributes:{videoURL:{type:"string"},content:{type:"string"},title:{type:"string"},tslClass:{type:"string"},showEditButton:{type:"boolean",default:false},displayUrlInput:{type:"boolean",default:true},isOpen:{type:"boolean",default:false},isColorPickerOpen:{type:"boolean",default:false},canIncludeBorder:{type:"boolean",default:true},canRoundCorners:{type:"boolean",default:false},tslQuery:{type:"string"},tslQueryParams:{type:"object"},colorPickerToggleText:{type:"string",default:"Select border color"},data_type:{},data_modus:{},data_view:{type:"string",default:"products"},data_event_id:{},data_dnt:{},data_manual_init:{},data_style_border_width:{},data_style_border_radius:{},data_style_theme:{type:"string",default:"products"},data_style_border_color:{type:"string",default:"#fff"},embedButtonText:{type:"string",default:"Embed"}},edit:function(s){let e=s.attributes.content;let t=s.attributes.showEditButton;let l=s.attributes.displayUrlInput;let o=s.attributes.isOpen;let n=s.attributes.isColorPickerOpen;let a=s.attributes.canIncludeBorder;let r=s.attributes.canRoundCorners;if(!e&&l===false){l=false}function i(e){return e.split("-").join("_")}async function c(e){let t=e.target.value;let l=t.substring(t.indexOf("?")+1);let o=t.split("?");let n=Object.fromEntries(new URLSearchParams(l));for(const[a,r]of Object.entries(n)){let e={};let t=i(a);e[t]=r;console.log("setting attr: ",e);s.setAttributes(e);s.attributes[t]=r}console.log(s.attributes.data_view);s.setAttributes({videoURL:o[0]});s.setAttributes({tslQueryParams:n})}function u(e){let t={};let l=e.data_style_border_color;let o=e.data_view;let n=e.data_style_theme;let a=e.canRoundCorners;let r=e.canIncludeBorder;if(o){t["data-view"]=o}if(l){t["data-style-border-color"]=l}if(n){t["data-style-theme"]=n}if(a){t["data-style-border-radius"]=a?"1":"0"}if(r){t["data-style-border-width"]=r?"1":"0"}console.log("selected data view: ",o);console.log("selected data style: ",n);console.log("use round corners: ",a);console.log("use border: ",r);console.log("selected border color: ",l);return t}function d(e){let t=document.createElement("div");t.innerHTML=e;let l=t.getElementsByTagName("script");let o=l.length;while(o--){l[o].parentNode.removeChild(l[o])}return t.innerHTML}async function b(e){e.preventDefault();let t=s.attributes.videoURL;s.setAttributes({displayUrlInput:false});s.setAttributes({showEditButton:true});let l=u(s.attributes);let o=Object.keys(l).map(e=>e+"="+l[e]).join("&");t+="?"+o;await C(t).then(e=>{s.setAttributes({content:e.data});s.setAttributes({embedButtonText:"Embed"})})}async function m(){let e=!s.attributes.displayUrlInput;s.setAttributes({displayUrlInput:e})}async function p(){s.setAttributes({isOpen:true})}async function f(){s.setAttributes({isOpen:false});s.setAttributes({isColorPickerOpen:false});s.setAttributes({embedButtonText:"Update"})}function g(e){console.log("setting data view changed: ",e);s.setAttributes({data_view:e})}function y(e){let t=!s.attributes.canIncludeBorder;s.setAttributes({canIncludeBorder:t})}function h(e){let t=!s.attributes.canRoundCorners;s.setAttributes({canRoundCorners:t})}function v(e){console.log("selecting color: ",e);let t=!s.attributes.isColorPickerOpen;if(t){s.setAttributes({colorPickerToggleText:"Set selected border color"})}else{s.setAttributes({colorPickerToggleText:"Select border color"})}s.setAttributes({isColorPickerOpen:t})}function _(e){console.log("border color: ",e);s.setAttributes({data_style_border_color:e.hex})}function E(e){console.log("setting data style: ",e);s.setAttributes({data_style_theme:e})}async function C(e){return k.apiFetch({path:"/talkshoplive/v1/embed",method:"POST",data:{url:e}}).then(e=>{console.log(e);return e})}return[I(B,{},I(T,{},t?I(A,{className:"components-toolbar__control",label:"Edit URL",icon:U,color:true,onClick:m}):null)),k.element.createElement("div",{},l===true?k.element.createElement(w,{className:"wp-block-embed",instructions:"TalkShopLive URL"},k.element.createElement("form",{onSubmit:b},k.element.createElement("input",{type:"url",className:"components-placeholder__input",value:s.attributes.videoURL,onChange:c}),k.element.createElement("button",{type:"submit",variant:"primary",onSubmit:b},s.attributes.embedButtonText),k.element.createElement("button",{type:"button",variant:"primary",onClick:p},"Configuration")),o&&k.element.createElement(O,{shouldCloseOnClickOutside:true,onRequestClose:f},k.element.createElement(x,{label:"Embed View",value:s.attributes.data_view,options:[{label:"Products",value:"products"},{label:"Chat",value:"chat"},{label:"Condensed",value:"default"}],onChange:g}),k.element.createElement(x,{label:"Embed Theme Style",value:s.attributes.data_style_theme,options:[{label:"Light",value:"light"},{label:"Dark",value:"dark"}],onChange:E}),k.element.createElement(L,{label:"Include border?",checked:a,help:"",onChange:y}),k.element.createElement(L,{label:"Rounded border corners?",checked:r,help:"",onChange:h}),k.element.createElement("a",{type:"button",onClick:v},s.attributes.colorPickerToggleText),n&&k.element.createElement("div",{className:"components-base-control"},k.element.createElement(P,{color:s.attributes.data_style_border_color,disableAlpha:true,onChangeComplete:_})))):k.element.createElement("div",{className:"wp-block-embed__wrapper"},k.element.createElement(R,{type:"embed",html:s.attributes.content,onFocus:()=>{console.log("embed clicked")}})))]},save:function(e){return k.element.createElement(o.Content,{tagName:"div",value:e.attributes.content})}})})(window.wp);