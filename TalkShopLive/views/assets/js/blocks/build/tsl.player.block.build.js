(function(e,t,l,C){console.log(C);let w=l.RichText;let k=C.components.Placeholder;let A=C.components.IconButton;let P=l.BlockControls;let O=C.components.ToggleControl;let T=C.components.ColorPicker;let R=C.components.Modal;let B=C.components.SelectControl;let n=C.components.Button;console.log(l);const o=C.element.createElement("svg",{viewBox:"0 0 38 38",foreground:"#ff0000"},C.element.createElement("path",{d:"M32.82,10.32H44.9a.2.2,0,0,1,.18.29L39.82,22.53a.51.51,0,0,1-.47.31H23.46a.52.52,0,0,1-.5-.38L17,1.08A1.49,1.49,0,0,0,15.53,0H11.6A1.56,1.56,0,0,0,10,1.48c-.05,2,2.79,1.35,4,1.46a.52.52,0,0,1,.49.38l6,21.39A1.48,1.48,0,0,0,22,25.79H40.69a1.49,1.49,0,0,0,1.37-.88L48.88,9.43a1.48,1.48,0,0,0-1.37-2.06H32.86a5.2,5.2,0,0,1,0,3Z",transform:"translate(-9.99)",fill:"#09bbd8"}),C.element.createElement("path",{d:"M27.75,5.1a3.63,3.63,0,1,1-3.63,3.63A3.64,3.64,0,0,1,27.75,5.1Z",transform:"translate(-9.99)",fill:"#ef4658"}));let L=t.createElement;e.registerBlockType("talkshoplive/player",{apiVersion:2,title:"TalkShopLive Player",icon:o,category:"talkshoplive",supports:{align:true},attributes:{videoURL:{type:"string"},content:{type:"string"},title:{type:"string"},tslClass:{type:"string"},showEditButton:{type:"boolean",default:false},displayUrlInput:{type:"boolean",default:true},isOpen:{type:"boolean",default:false},isColorPickerOpen:{type:"boolean",default:false},canIncludeBorder:{type:"boolean",default:true},canRoundCorners:{type:"boolean",default:false},tslQuery:{type:"string"},tslQueryParams:{type:"object"},colorPickerToggleText:{type:"string",default:"Select border color"},data_type:{},data_modus:{},data_view:{type:"string",default:"products"},data_event_id:{},data_dnt:{},data_manual_init:{},data_style_border_width:{},data_style_border_radius:{},data_style_theme:{type:"string",default:"products"},data_style_border_color:{type:"string",default:"#fff"}},edit:function(s){let e=s.attributes.content;let t=s.attributes.showEditButton;let l=s.attributes.displayUrlInput;let n=s.attributes.isOpen;let o=s.attributes.isColorPickerOpen;let a=s.attributes.canIncludeBorder;let r=s.attributes.canRoundCorners;if(!e&&l===false){l=false}function i(e){return e.split("-").join("_")}async function c(e){let t=e.target.value;let l=t.substring(t.indexOf("?")+1);let n=t.split("?");let o=Object.fromEntries(new URLSearchParams(l));for(const[a,r]of Object.entries(o)){let e={};let t=i(a);e[t]=r;console.log("setting attr: ",e);s.setAttributes(e);s.attributes[t]=r}console.log(s.attributes.data_view);s.setAttributes({videoURL:n[0]});s.setAttributes({tslQueryParams:o})}function u(e){let t={};let l=e.data_style_border_color;let n=e.data_view;let o=e.data_style_theme;let a=e.canRoundCorners;let r=e.canIncludeBorder;if(n){t["data-view"]=n}if(l){t["data-style-border-color"]=l}if(o){t["data-style-theme"]=o}if(a){t["data-style-border-radius"]=a?"1":"0"}if(r){t["data-style-border-width"]=r?"1":"0"}console.log("selected data view: ",n);console.log("selected data style: ",o);console.log("use round corners: ",a);console.log("use border: ",r);console.log("selected border color: ",l);return t}async function d(e){e.preventDefault();let t=s.attributes.videoURL;s.setAttributes({displayUrlInput:false});s.setAttributes({showEditButton:true});let l=u(s.attributes);let n=Object.keys(l).map(e=>e+"="+l[e]).join("&");t+="?"+n;await E(t).then(e=>{s.setAttributes({content:e.data});console.log("new content: ",e.data)})}async function m(){console.log("switching back url");let e=!s.attributes.displayUrlInput;s.setAttributes({displayUrlInput:e})}async function b(){s.setAttributes({isOpen:true})}async function p(){s.setAttributes({isOpen:false});s.setAttributes({isColorPickerOpen:false})}function f(e){console.log("setting data view changed: ",e);s.setAttributes({data_view:e})}function g(e){let t=!s.attributes.canIncludeBorder;s.setAttributes({canIncludeBorder:t})}function y(e){let t=!s.attributes.canRoundCorners;s.setAttributes({canRoundCorners:t})}function _(e){console.log("selecting color: ",e);let t=!s.attributes.isColorPickerOpen;if(t){s.setAttributes({colorPickerToggleText:"Set selected border color"})}else{s.setAttributes({colorPickerToggleText:"Select border color"})}s.setAttributes({isColorPickerOpen:t})}function h(e){console.log("border color: ",e);s.setAttributes({data_style_border_color:e.hex})}function v(e){console.log("setting data style: ",e.target.value);s.setAttributes({data_style_theme:e.target.value})}async function E(e){return C.apiFetch({path:"/talkshoplive/v1/embed",method:"POST",data:{url:e}}).then(e=>{console.log(e);return e})}return[L(P,{},t?L(A,{className:"components-toolbar__control",label:"Edit URL",icon:"edit",color:true,onClick:m}):null),C.element.createElement("div",{},l===true?C.element.createElement(k,{className:"wp-block-embed",instructions:"TalkShopLive URL"},C.element.createElement("form",{onSubmit:d},C.element.createElement("input",{type:"url",className:"components-placeholder__input",value:s.attributes.videoURL,onChange:c}),C.element.createElement("button",{type:"submit",variant:"primary",onSubmit:d},"Embed"),C.element.createElement("button",{type:"button",variant:"primary",onClick:b},"Configuration")),n&&C.element.createElement(R,{shouldCloseOnClickOutside:true,onRequestClose:p},C.element.createElement(B,{label:"Embed View",value:s.attributes.data_view,options:[{label:"Products",value:"products"},{label:"Chat",value:"chat"},{label:"Condensed",value:"default"}],onChange:f}),C.element.createElement("div",{className:"components-base-control"},C.element.createElement("div",{className:"components-base-control__field"},C.element.createElement("label",{className:"components-base-control__label"},"Embed Theme Style"),C.element.createElement("select",{label:"Embed Theme Style",id:"data_style_theme",value:s.attributes.data_style_theme,className:"components-select-control__input",onChange:v},C.element.createElement("option",{value:"light"},"Light"),C.element.createElement("option",{value:"dark"},"Dark")))),C.element.createElement(O,{label:"Include border?",checked:a,help:"",onChange:g}),C.element.createElement(O,{label:"Rounded border corners?",checked:r,help:"",onChange:y}),C.element.createElement("a",{type:"button",onClick:_},s.attributes.colorPickerToggleText),o&&C.element.createElement("div",{className:"components-base-control"},C.element.createElement(T,{color:s.attributes.data_style_border_color,disableAlpha:true,onChangeComplete:h})))):C.element.createElement("div",{}),C.element.createElement(w.Content,{tagName:"div",value:s.attributes.content}))]},save:function(e){return C.element.createElement(w.Content,{tagName:"div",value:e.attributes.content})}})})(window.wp.blocks,window.wp.element,window.wp.editor,window.wp);